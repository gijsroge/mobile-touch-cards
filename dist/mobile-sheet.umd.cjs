(function(e,p){typeof exports=="object"&&typeof module<"u"?module.exports=p(require("vue")):typeof define=="function"&&define.amd?define(["vue"],p):(e=typeof globalThis<"u"?globalThis:e||self,e.MobileSheet=p(e.Vue))})(this,function(e){"use strict";const p=(l,r,o)=>Math.min(Math.max(l,r),o),N=(l,r,o)=>{let s=l;if(l>o){const a=s-o;s-=a*.6}return l<r&&(s-=s*.6),s},$=({progress:l,duration:r})=>{const o=e.ref(l.value),s=e.ref(null);e.watch(l,(d,m)=>a(m,d));const a=(d,m)=>{const c=performance.now(),f=i=>i*(2-i),h=()=>{const i=performance.now()-c,g=p(i/r,0,1);o.value=f(g)*(m-d)+d,g<1&&(s.value=requestAnimationFrame(h))};s.value=requestAnimationFrame(h)};return e.onUnmounted(()=>{s.value&&cancelAnimationFrame(s.value)}),{animatedProgress:o}};function O(l){const r=e.ref(!1);let o=null,s=null,a=null,d=null;const m=9,c=()=>{r.value=!0,o=document.activeElement,a==null||a.focus()},f=()=>{r.value=!1,o==null||o.focus()},h=i=>{if(r.value){var g=i.key==="Tab"||i.keyCode===m;g&&(i.shiftKey?document.activeElement===a&&(d==null||d.focus(),i.preventDefault()):document.activeElement===d&&(a==null||a.focus(),i.preventDefault()))}};return e.watchEffect(()=>{l.value&&(s=l.value.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])'),a=s[0],d=s[s.length-1],l.value.addEventListener("keydown",h))}),e.onUnmounted(()=>{var i;return(i=l.value)==null?void 0:i.removeEventListener("keydown",h)}),{trap:c,release:f,isLocked:r}}const V=`<svg width="70" height="3" viewBox="0 0 70 3" xmlns="http://www.w3.org/2000/svg">
<rect width="70" height="3" rx="3" fill="currentColor"/>
</svg>
`,j=["aria-label"],q=["innerHTML"],z={inheritAttrs:!1};return e.defineComponent({...z,__name:"mobile-sheet",props:{rootClass:{type:String,default:""},maxDistance:{type:Number,default:null},open:{type:Boolean,default:!1},dragEntireCard:{type:Boolean,default:!0},thresHold:{type:Number,default:50},handleHeight:{type:Number,default:50},a11yWarnings:{type:Boolean,default:!0},ariaLabel:{type:String,default:"Open modal"}},emits:["progress","open","close","drag","start-drag","stop-drag"],setup(l,{emit:r}){const o=l,s=typeof document<"u",a=e.ref(null),d=e.ref(null),m=e.ref(null),c=e.ref(!1),f=e.ref(o.maxDistance),h=e.ref(o.handleHeight),i=e.ref(!0),g=e.ref(!1),H=e.ref(0),T=e.ref(0),u=e.ref(0),w=e.ref(!1),C=e.ref(!1),S=e.ref(0),k=e.ref(0),D=e.ref(1),y=e.ref(null),M=e.ref(null),{trap:I,release:U}=O(d);e.onMounted(()=>{window.addEventListener("click",t=>W(t),{passive:!0}),window.addEventListener("mouseup",()=>A(),{passive:!0}),window.addEventListener("mousemove",Y,{passive:!0}),window.addEventListener("keydown",t=>{t.key==="Escape"&&b()})}),e.onUnmounted(()=>{window.removeEventListener("mousemove",()=>{}),window.removeEventListener("mouseup",()=>{}),window.removeEventListener("keydown",()=>b)});const F=()=>{c.value||(u.value=f.value,r("open"))},b=()=>{c.value||(u.value=0,r("close"))},K=()=>{w.value?b():F()},W=t=>{a.value&&(a.value.contains(t.target)||b())},P=()=>{S.value=new Date().getTime()},E=t=>{if(t.target instanceof HTMLElement&&t.target.closest("[data-ignore-drag]"))return;D.value=1,g.value=!0;const n=t instanceof TouchEvent?t.touches[0].clientY:t.clientY;H.value=n+u.value,P(),r("start-drag")};let B=0;const L=e.ref(!1),Y=t=>{if(!g.value)return;const n=t instanceof TouchEvent?t.touches[0].clientY:t.clientY;L.value||(B=n),L.value=!0,k.value=Math.abs(B-n),k.value>2&&(c.value=!0),c.value&&(T.value!==n&&(y.value=n>T.value?"down":"up"),M.value!==y.value&&P(),T.value=n,M.value=y.value,u.value=N(H.value-n,0,f.value),r("drag",u.value))},A=async()=>{await new Promise(v=>setTimeout(v,10)),g.value=!1,c.value=!1,L.value=!1;const n=new Date().getTime()-S.value;D.value=k.value/n*1,y.value==="up"?u.value>=o.thresHold?u.value=f.value:u.value=0:u.value<f.value-o.thresHold?u.value=0:u.value=f.value,r("stop-drag")},G=e.computed(()=>{const t={position:"fixed",willChange:"transform",left:0,right:0,transition:c.value||i.value?"none":`transform ${X.value}s ease-out`};return t.top="100%",t.transform=`translateY(${(u.value+h.value)*-1}px)`,t}),x=s?new ResizeObserver(t=>{if(!a.value)return;const{blockSize:n}=t[0].borderBoxSize[0],v=window.innerHeight;m.value&&(h.value=m.value.clientHeight),f.value=p(n,0,v)-h.value,i.value&&o.open&&(u.value=f.value)}):null,J=()=>{if(!a.value||!o.a11yWarnings)return;const t=a.value.getAttribute("aria-labelledby");t?document.getElementById(t)||console.warn(`[mobile-sheet.js] The aria labelledby "${t}" is not pointing to a valid element inside the mobile sheet content`):console.warn("[mobile-sheet.js] The <mobile-sheet> element should have an aria-labelledby attribute that points to the id of a title element inside the content")};e.onMounted(()=>{setTimeout(()=>i.value=!1,1)});const Q=e.computed(()=>p(u.value/f.value,0,1)),X=e.computed(()=>p(.4/D.value,.05,.2).toFixed(2)),{animatedProgress:R}=$({progress:Q,duration:250});return e.watch(R,()=>{r("progress",R.value)}),e.watch(w,()=>{w.value?I():U()}),e.watch(C,()=>{C.value?document.documentElement.style.setProperty("overflow","hidden"):document.documentElement.style.removeProperty("overflow")}),e.watch(c,()=>C.value=c.value||w.value),e.watch(u,()=>{c.value||(w.value=u.value>o.thresHold)}),e.watchEffect(()=>{a.value&&(x==null||x.observe(a.value),J())}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"cardRef",ref:a,style:e.normalizeStyle(e.unref(G)),class:e.normalizeClass([l.rootClass]),"data-modal-sheet":"","aria-modal":"true",role:"dialog"},[e.createElementVNode("div",e.mergeProps({ref_key:"innerCardRef",ref:d},t.$attrs,{style:{marginTop:"0px !important",touchAction:"none"},onTouchend:n[2]||(n[2]=()=>A()),onTouchmovePassive:Y,onMousedown:n[3]||(n[3]=v=>l.dragEntireCard?E(v):null),onTouchstartPassive:n[4]||(n[4]=v=>l.dragEntireCard?E(v):null)}),[e.createElementVNode("button",{ref_key:"handleRef",ref:m,onClick:K,onMousedown:n[0]||(n[0]=v=>l.dragEntireCard?null:E(v)),onTouchstartPassive:n[1]||(n[1]=v=>l.dragEntireCard?null:E(v)),"aria-label":l.ariaLabel},[e.renderSlot(t.$slots,"handle",{},()=>[e.createElementVNode("div",{style:{userSelect:"none",cursor:"move",height:"50px",position:"relative",width:"100%",color:"white",display:"flex",alignItems:"center",justifyContent:"center"},innerHTML:e.unref(V)},null,8,q)])],40,j),e.renderSlot(t.$slots,"default")],16)],6))}})});
