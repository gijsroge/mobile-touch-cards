(function(e,m){typeof exports=="object"&&typeof module<"u"?module.exports=m(require("vue")):typeof define=="function"&&define.amd?define(["vue"],m):(e=typeof globalThis<"u"?globalThis:e||self,e.MobileSheet=m(e.Vue))})(this,function(e){"use strict";const m=(o,s,l)=>Math.min(Math.max(o,s),l),q=(o,s,l)=>{let i=o;if(o>l){const a=i-l;i-=a*.6}return o<s&&(i-=i*.6),i},I=({progress:o,duration:s})=>{const l=e.ref(o.value),i=e.ref(null);e.watch(o,(f,h)=>a(h,f));const a=(f,h)=>{const v=performance.now(),g=r=>r*(2-r),c=()=>{const r=performance.now()-v,p=m(r/s,0,1);l.value=g(p)*(h-f)+f,p<1&&(i.value=requestAnimationFrame(c))};i.value=requestAnimationFrame(c)};return e.onUnmounted(()=>{i.value&&cancelAnimationFrame(i.value)}),{animatedProgress:l}};function F(o){const s=e.ref(!1);let l=null,i=null,a=null,f=null;const h=9,v=()=>{s.value=!0,l=document.activeElement,a==null||a.focus()},g=()=>{s.value=!1,l==null||l.focus()},c=r=>{if(s.value){var p=r.key==="Tab"||r.keyCode===h;p&&(r.shiftKey?document.activeElement===a&&(f==null||f.focus(),r.preventDefault()):document.activeElement===f&&(a==null||a.focus(),r.preventDefault()))}};return e.watchEffect(()=>{o.value&&(i=o.value.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])'),a=i[0],f=i[i.length-1],o.value.addEventListener("keydown",c))}),e.onUnmounted(()=>{var r;return(r=o.value)==null?void 0:r.removeEventListener("keydown",c)}),{trap:v,release:g,isLocked:s}}const U=`<svg width="70" height="3" viewBox="0 0 70 3" xmlns="http://www.w3.org/2000/svg">
<rect width="70" height="3" rx="3" fill="currentColor"/>
</svg>
`,K=["aria-label"],W=["innerHTML"],G={inheritAttrs:!1};return e.defineComponent({...G,__name:"mobile-sheet",props:{closeAble:{type:Boolean,default:!0},rootClass:{type:String,default:""},maxDistance:{type:Number,default:null},open:{type:Boolean,default:!1},dragEntireCard:{type:Boolean,default:!0},thresHold:{type:Number,default:50},handleHeight:{type:Number,default:50},a11yWarnings:{type:Boolean,default:!0},ariaLabel:{type:String,default:"Open modal"}},emits:["progress","open","close","drag","start-drag","stop-drag"],setup(o,{emit:s}){const l=o,i=typeof document<"u",a=e.ref(null),f=e.ref(null),h=e.ref(null),v=e.ref(!1),g=e.ref(!1),c=e.ref(l.maxDistance),r=e.ref(l.handleHeight),p=e.ref(!0),C=e.ref(!1),B=e.ref(0),k=e.ref(0),u=e.ref(0),w=e.ref(!1),H=e.ref(!1),S=e.ref(0),x=e.ref(0),b=e.ref(1),E=e.ref(null),A=e.ref(null),{trap:J,release:Q}=F(f);e.onMounted(()=>{window.addEventListener("click",t=>Z(t),{passive:!0}),window.addEventListener("mouseup",()=>z(),{passive:!0}),window.addEventListener("mousemove",R,{passive:!0}),window.addEventListener("keydown",t=>{t.key==="Escape"&&y()})}),e.onUnmounted(()=>{window.removeEventListener("mousemove",()=>{}),window.removeEventListener("mouseup",()=>{}),window.removeEventListener("keydown",()=>y)});const M=({force:t}={force:null})=>{setTimeout(()=>{!v.value&&t!==null&&!t||(u.value=c.value)})},y=({force:t}={force:null})=>{!v.value&&t!==null&&!t||(u.value=0)},X=()=>{v.value||(w.value?y():M())},Z=t=>{a.value&&(a.value.contains(t.target)||y())},P=()=>{S.value=new Date().getTime()},T=t=>{if(t.target instanceof HTMLElement&&t.target.closest("[data-ignore-drag]"))return;b.value=1,C.value=!0,g.value=!0;const n=t instanceof TouchEvent?t.touches[0].clientY:t.clientY;B.value=n+u.value,P(),s("start-drag")};let Y=0;const D=e.ref(!1),R=t=>{if(!C.value)return;const n=t instanceof TouchEvent?t.touches[0].clientY:t.clientY;D.value||(Y=n),D.value=!0,x.value=Math.abs(Y-n),x.value>2&&(v.value=!0),v.value&&(k.value!==n&&(E.value=n>k.value?"down":"up"),A.value!==E.value&&P(),k.value=n,A.value=E.value,u.value=q(B.value-n,0,c.value),s("drag",u.value))},z=async()=>{await new Promise(d=>setTimeout(d,10)),C.value=!1,v.value=!1,setTimeout(()=>g.value=!1,300),D.value=!1;const n=new Date().getTime()-S.value;b.value=x.value/n*1,E.value==="up"?u.value>=l.thresHold?u.value=c.value:u.value=0:u.value<c.value-l.thresHold?u.value=0:u.value=c.value,s("stop-drag")},_=e.computed(()=>{const t=g.value?le.value:"cubic-bezier(0.65, 0, 0.35, 1)",n={position:"fixed",willChange:"transform",left:0,right:0,transition:v.value||p.value?"none":`transform ${ne.value}s ${t}`};n.top="100%";let d=l.closeAble?0:r.value;return w.value&&(d=r.value),n.transform=`translateY(${(u.value+d)*-1}px)`,n}),L=i?new ResizeObserver(t=>{var N,O,V,j;if(!a.value)return;let n=(N=t[0])!=null&&N.borderBoxSize?(V=(O=t[0])==null?void 0:O.borderBoxSize[0])==null?void 0:V.blockSize:null;n||(n=(j=t[0])==null?void 0:j.contentRect.height);const d=window.innerHeight;h.value&&(r.value=h.value.clientHeight),c.value=m(n,0,d)-r.value,p.value&&l.open&&(u.value=c.value)}):null,ee=()=>{if(!a.value||!l.a11yWarnings)return;const t=a.value.getAttribute("aria-labelledby");t?document.getElementById(t)||console.warn(`[mobile-sheet.js] The aria labelledby "${t}" is not pointing to a valid element inside the mobile sheet content`):console.warn("[mobile-sheet.js] The <mobile-sheet> element should have an aria-labelledby attribute that points to the id of a title element inside the content")};e.watch(()=>l.open,t=>{t?M({force:!0}):y({force:!0})}),e.onMounted(()=>{setTimeout(()=>p.value=!1,1)});const te=e.computed(()=>m(u.value/c.value,0,1)),ne=e.computed(()=>m(.4/b.value,.3,.6).toFixed(2)),le=e.computed(()=>`cubic-bezier(0.22, ${m(b.value,1,1.3).toFixed(2)}, 0.35, 1)`),{animatedProgress:$}=I({progress:te,duration:250});return e.watch($,()=>{s("progress",$.value)}),e.watch(w,()=>{w.value?(s("open"),J()):(s("close"),Q())}),e.watch(H,t=>{t?document.documentElement.style.setProperty("overflow","hidden"):document.documentElement.style.removeProperty("overflow")}),e.watchEffect(()=>{H.value=v.value||w.value}),e.watch(u,()=>{v.value||(w.value=u.value>l.thresHold)}),e.watchEffect(()=>{a.value&&(L==null||L.observe(a.value),ee())}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"cardRef",ref:a,style:e.normalizeStyle(e.unref(_)),class:e.normalizeClass([o.rootClass]),"data-modal-sheet":"","aria-modal":"true",role:"dialog"},[e.createElementVNode("div",e.mergeProps({ref_key:"innerCardRef",ref:f},t.$attrs,{style:{marginTop:"0px !important",touchAction:"none"},onTouchend:n[2]||(n[2]=()=>z()),onTouchmovePassive:R,onMousedown:n[3]||(n[3]=d=>o.dragEntireCard?T(d):null),onTouchstartPassive:n[4]||(n[4]=d=>o.dragEntireCard?T(d):null)}),[e.createElementVNode("button",{ref_key:"handleRef",ref:h,onClick:X,onMousedown:n[0]||(n[0]=d=>o.dragEntireCard?null:T(d)),onTouchstartPassive:n[1]||(n[1]=d=>o.dragEntireCard?null:T(d)),"aria-label":o.ariaLabel},[e.renderSlot(t.$slots,"handle",{},()=>[e.createElementVNode("div",{style:{userSelect:"none",cursor:"move",height:"50px",position:"relative",width:"100%",color:"white",display:"flex",alignItems:"center",justifyContent:"center"},innerHTML:e.unref(U)},null,8,W)])],40,K),e.renderSlot(t.$slots,"default")],16)],6))}})});
