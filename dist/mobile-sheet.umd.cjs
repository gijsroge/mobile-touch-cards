(function(e,h){typeof exports=="object"&&typeof module<"u"?module.exports=h(require("vue")):typeof define=="function"&&define.amd?define(["vue"],h):(e=typeof globalThis<"u"?globalThis:e||self,e.MobileSheet=h(e.Vue))})(this,function(e){"use strict";const h=(o,s,a)=>Math.min(Math.max(o,s),a),q=(o,s,a)=>{let i=o;if(o>a){const l=i-a;i-=l*.6}return o<s&&(i-=i*.6),i},I=({progress:o,duration:s})=>{const a=e.ref(o.value),i=e.ref(null);e.watch(o,(f,m)=>l(m,f));const l=(f,m)=>{const v=performance.now(),p=r=>r*(2-r),d=()=>{const r=performance.now()-v,g=h(r/s,0,1);a.value=p(g)*(m-f)+f,g<1&&(i.value=requestAnimationFrame(d))};i.value=requestAnimationFrame(d)};return e.onUnmounted(()=>{i.value&&cancelAnimationFrame(i.value)}),{animatedProgress:a}};function U(o){const s=e.ref(!1);let a=null,i=null,l=null,f=null;const m=9,v=()=>{s.value=!0,a=document.activeElement,l==null||l.focus()},p=()=>{s.value=!1,a==null||a.focus()},d=r=>{if(s.value){var g=r.key==="Tab"||r.keyCode===m;g&&(r.shiftKey?document.activeElement===l&&(f==null||f.focus(),r.preventDefault()):document.activeElement===f&&(l==null||l.focus(),r.preventDefault()))}};return e.watchEffect(()=>{o.value&&(i=o.value.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])'),l=i[0],f=i[i.length-1],o.value.addEventListener("keydown",d))}),e.onUnmounted(()=>{var r;return(r=o.value)==null?void 0:r.removeEventListener("keydown",d)}),{trap:v,release:p,isLocked:s}}const F=`<svg width="70" height="3" viewBox="0 0 70 3" xmlns="http://www.w3.org/2000/svg">
<rect width="70" height="3" rx="3" fill="currentColor"/>
</svg>
`,K=["aria-label"],W=["innerHTML"],G={inheritAttrs:!1};return e.defineComponent({...G,__name:"mobile-sheet",props:{closeAble:{type:Boolean,default:!0},rootClass:{type:String,default:""},maxDistance:{type:Number,default:null},open:{type:Boolean,default:!1},dragEntireCard:{type:Boolean,default:!0},thresHold:{type:Number,default:50},handleHeight:{type:Number,default:50},a11yWarnings:{type:Boolean,default:!0},ariaLabel:{type:String,default:"Open modal"}},emits:["progress","open","close","drag","start-drag","stop-drag"],setup(o,{emit:s}){const a=o,i=typeof document<"u",l=e.ref(null),f=e.ref(null),m=e.ref(null),v=e.ref(!1),p=e.ref(!1),d=e.ref(a.maxDistance),r=e.ref(a.handleHeight),g=e.ref(!0),T=e.ref(!1),S=e.ref(0),C=e.ref(0),u=e.ref(0),w=e.ref(!1),H=e.ref(!1),B=e.ref(0),k=e.ref(0),D=e.ref(1),b=e.ref(null),A=e.ref(null),{trap:J,release:Q}=U(f);e.onMounted(()=>{window.addEventListener("click",t=>Z(t),{passive:!0}),window.addEventListener("mouseup",()=>N(),{passive:!0}),window.addEventListener("mousemove",R,{passive:!0}),window.addEventListener("keydown",t=>{t.key==="Escape"&&y()})}),e.onUnmounted(()=>{window.removeEventListener("mousemove",()=>{}),window.removeEventListener("mouseup",()=>{}),window.removeEventListener("keydown",()=>y)});const M=({force:t}={force:null})=>{setTimeout(()=>{!v.value&&t!==null&&!t||(u.value=d.value)})},y=({force:t}={force:null})=>{!v.value&&t!==null&&!t||(u.value=0)},X=()=>{v.value||(w.value?y():M())},Z=t=>{l.value&&(l.value.contains(t.target)||y())},P=()=>{B.value=new Date().getTime()},E=t=>{if(t.target instanceof HTMLElement&&t.target.closest("[data-ignore-drag]"))return;D.value=1,T.value=!0,p.value=!0;const n=t instanceof TouchEvent?t.touches[0].clientY:t.clientY;S.value=n+u.value,P(),s("start-drag")};let Y=0;const x=e.ref(!1),R=t=>{if(!T.value)return;const n=t instanceof TouchEvent?t.touches[0].clientY:t.clientY;x.value||(Y=n),x.value=!0,k.value=Math.abs(Y-n),k.value>2&&(v.value=!0),v.value&&(C.value!==n&&(b.value=n>C.value?"down":"up"),A.value!==b.value&&P(),C.value=n,A.value=b.value,u.value=q(S.value-n,0,d.value),s("drag",u.value))},N=async()=>{await new Promise(c=>setTimeout(c,10)),T.value=!1,v.value=!1,setTimeout(()=>p.value=!1,300),x.value=!1;const n=new Date().getTime()-B.value;D.value=k.value/n*1,b.value==="up"?u.value>=a.thresHold?u.value=d.value:u.value=0:u.value<d.value-a.thresHold?u.value=0:u.value=d.value,s("stop-drag")},_=e.computed(()=>{const t=p.value?"ease-out":"cubic-bezier(0.65, 0, 0.35, 1)",n={position:"fixed",willChange:"transform",left:0,right:0,transition:v.value||g.value?"none":`transform ${ne.value}s ${t}`};n.top="100%";let c=a.closeAble?0:r.value;return w.value&&(c=r.value),n.transform=`translateY(${(u.value+c)*-1}px)`,n}),L=i?new ResizeObserver(t=>{var z,V,O,j;if(!l.value)return;let n=(z=t[0])!=null&&z.borderBoxSize?(O=(V=t[0])==null?void 0:V.borderBoxSize[0])==null?void 0:O.blockSize:null;n||(n=(j=t[0])==null?void 0:j.contentRect.height);const c=window.innerHeight;m.value&&(r.value=m.value.clientHeight),d.value=h(n,0,c)-r.value,g.value&&a.open&&(u.value=d.value)}):null,ee=()=>{if(!l.value||!a.a11yWarnings)return;const t=l.value.getAttribute("aria-labelledby");t?document.getElementById(t)||console.warn(`[mobile-sheet.js] The aria labelledby "${t}" is not pointing to a valid element inside the mobile sheet content`):console.warn("[mobile-sheet.js] The <mobile-sheet> element should have an aria-labelledby attribute that points to the id of a title element inside the content")};e.watch(()=>a.open,t=>{t?M({force:!0}):y({force:!0})}),e.onMounted(()=>{setTimeout(()=>g.value=!1,1)});const te=e.computed(()=>h(u.value/d.value,0,1)),ne=e.computed(()=>h(.4/D.value,.05,.2).toFixed(2)),{animatedProgress:$}=I({progress:te,duration:250});return e.watch($,()=>{s("progress",$.value)}),e.watch(w,()=>{w.value?(s("open"),J()):(s("close"),Q())}),e.watch(H,t=>{t?document.documentElement.style.setProperty("overflow","hidden"):document.documentElement.style.removeProperty("overflow")}),e.watchEffect(()=>{H.value=v.value||w.value}),e.watch(u,()=>{v.value||(w.value=u.value>a.thresHold)}),e.watchEffect(()=>{l.value&&(L==null||L.observe(l.value),ee())}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"cardRef",ref:l,style:e.normalizeStyle(e.unref(_)),class:e.normalizeClass([o.rootClass]),"data-modal-sheet":"","aria-modal":"true",role:"dialog"},[e.createElementVNode("div",e.mergeProps({ref_key:"innerCardRef",ref:f},t.$attrs,{style:{marginTop:"0px !important",touchAction:"none"},onTouchend:n[2]||(n[2]=()=>N()),onTouchmovePassive:R,onMousedown:n[3]||(n[3]=c=>o.dragEntireCard?E(c):null),onTouchstartPassive:n[4]||(n[4]=c=>o.dragEntireCard?E(c):null)}),[e.createElementVNode("button",{ref_key:"handleRef",ref:m,onClick:X,onMousedown:n[0]||(n[0]=c=>o.dragEntireCard?null:E(c)),onTouchstartPassive:n[1]||(n[1]=c=>o.dragEntireCard?null:E(c)),"aria-label":o.ariaLabel},[e.createTextVNode(e.toDisplayString(p.value)+" ",1),e.renderSlot(t.$slots,"handle",{},()=>[e.createElementVNode("div",{style:{userSelect:"none",cursor:"move",height:"50px",position:"relative",width:"100%",color:"white",display:"flex",alignItems:"center",justifyContent:"center"},innerHTML:e.unref(F)},null,8,W)])],40,K),e.renderSlot(t.$slots,"default")],16)],6))}})});
