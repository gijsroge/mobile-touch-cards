(function(e,g){typeof exports=="object"&&typeof module<"u"?module.exports=g(require("vue")):typeof define=="function"&&define.amd?define(["vue"],g):(e=typeof globalThis<"u"?globalThis:e||self,e.MobileSheet=g(e.Vue))})(this,function(e){"use strict";const g=(o,s,r)=>Math.min(Math.max(o,s),r),D=(o,s,r)=>{let l=o;if(o>r){const n=l-r;l-=n*.6}return o<s&&(l-=l*.6),l},L=({progress:o,duration:s})=>{const r=e.ref(o.value),l=e.ref(null);e.watch(o,(d,c)=>n(c,d));const n=(d,c)=>{const f=performance.now(),p=i=>i*(2-i),m=()=>{const i=performance.now()-f,h=g(i/s,0,1);r.value=p(h)*(c-d)+d,h<1&&(l.value=requestAnimationFrame(m))};l.value=requestAnimationFrame(m)};return e.onUnmounted(()=>{l.value&&cancelAnimationFrame(l.value)}),{animatedProgress:r}};function M(o){const s=e.ref(!1);let r=document.activeElement,l=null,n=null,d=null;const c=9,f=()=>{s.value=!0,r=document.activeElement,n==null||n.focus()},p=()=>{s.value=!1,r.focus()},m=i=>{if(s.value){var h=i.key==="Tab"||i.keyCode===c;h&&(i.shiftKey?document.activeElement===n&&(d==null||d.focus(),i.preventDefault()):document.activeElement===d&&(n==null||n.focus(),i.preventDefault()))}};return e.watchEffect(()=>{o.value&&(l=o.value.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])'),n=l[0],d=l[l.length-1],o.value.addEventListener("keydown",m))}),e.onUnmounted(()=>{var i;return(i=o.value)==null?void 0:i.removeEventListener("keydown",m)}),{trap:f,release:p,isLocked:s}}const P=`<svg width="70" height="3" viewBox="0 0 70 3" xmlns="http://www.w3.org/2000/svg">
<rect width="70" height="3" rx="3" fill="currentColor"/>
</svg>
`,S=["innerHTML"],A={inheritAttrs:!1};return e.defineComponent({...A,__name:"mobile-card",props:{rootClass:{type:String,default:""},maxDistance:{type:Number,default:null},open:{type:Boolean,default:!1},dragEntireCard:{type:Boolean,default:!0},thresHold:{type:Number,default:50},handleHeight:{type:Number,default:50}},emits:["progress","open","close","drag","start-drag","stop-drag"],setup(o,{emit:s}){const r=o,l=typeof document<"u",n=e.ref(null),d=e.ref(null),c=e.ref(!1),f=e.ref(r.maxDistance),p=e.ref(r.handleHeight),m=e.ref(!0),i=e.ref(!1),h=e.ref(0),u=e.ref(0),w=e.ref(!1),{trap:Y,release:B}=M(n);e.onMounted(()=>{window.addEventListener("click",t=>q(t),{passive:!0}),window.addEventListener("mouseup",()=>k(),{passive:!0}),window.addEventListener("mousemove",x,{passive:!0})}),e.onUnmounted(()=>{window.removeEventListener("mousemove",()=>{}),window.removeEventListener("mouseup",()=>{})});const N=()=>{c.value||(u.value=f.value,s("open"))},b=()=>{c.value||(u.value=0,s("close"))},R=()=>{w.value?b():N()},q=t=>{n.value&&(n.value.contains(t.target)||b())},y=t=>{if(t.target instanceof HTMLElement&&t.target.closest("[data-ignore-drag]"))return;i.value=!0;const a=t instanceof TouchEvent?t.touches[0].clientY:t.clientY;h.value=a+u.value,s("start-drag")};let C=0;const E=e.ref(!1),x=t=>{if(!i.value)return;const a=t instanceof TouchEvent?t.touches[0].clientY:t.clientY;E.value||(C=a),E.value=!0,Math.abs(C-a)>2&&(c.value=!0),u.value=D(h.value-a,0,f.value),s("drag",u.value)},k=async()=>{await new Promise(t=>setTimeout(t,10)),i.value=!1,c.value=!1,E.value=!1,w.value?u.value<f.value-r.thresHold?u.value=0:u.value=f.value:u.value>=r.thresHold?u.value=f.value:u.value=0,s("stop-drag")},z=e.computed(()=>{const t={position:"fixed",willChange:"transform",left:0,right:0,transition:c.value||m.value?"none":"transform 0.2s ease-out"};return t.top="100%",t.transform=`translateY(${(u.value+p.value)*-1}px)`,t}),T=l?new ResizeObserver(t=>{if(!n.value)return;const{blockSize:a}=t[0].borderBoxSize[0],v=window.innerHeight;d.value&&(p.value=d.value.clientHeight),f.value=g(a,0,v)-p.value,m.value&&r.open&&(u.value=f.value)}):null;e.onMounted(()=>{setTimeout(()=>m.value=!1,1)});const O=e.computed(()=>g(u.value/f.value,0,1)),{animatedProgress:H}=L({progress:O,duration:250});return e.watch(H,()=>{s("progress",H.value)}),e.watch(w,()=>w.value?Y():B()),e.watch(u,()=>{c.value||(w.value=u.value>r.thresHold)}),e.watchEffect(()=>{n.value&&(T==null||T.observe(n.value))}),(t,a)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"cardRef",ref:n,style:e.normalizeStyle(e.unref(z)),class:e.normalizeClass([o.rootClass]),"data-modal-sheet":""},[e.createElementVNode("div",e.mergeProps(t.$attrs,{style:{marginTop:"0px !important",touchAction:"none"},onTouchend:a[2]||(a[2]=()=>k()),onTouchmovePassive:x,onMousedown:a[3]||(a[3]=v=>o.dragEntireCard?y(v):null),onTouchstartPassive:a[4]||(a[4]=v=>o.dragEntireCard?y(v):null)}),[e.createElementVNode("div",{ref_key:"handleRef",ref:d,onClick:R,onMousedown:a[0]||(a[0]=v=>o.dragEntireCard?null:y(v)),onTouchstartPassive:a[1]||(a[1]=v=>o.dragEntireCard?null:y(v))},[e.renderSlot(t.$slots,"handle",{},()=>[e.createElementVNode("div",{style:{userSelect:"none",cursor:"move",height:"50px",position:"relative",width:"100%",color:"white",display:"flex",alignItems:"center",justifyContent:"center"},innerHTML:e.unref(P)},null,8,S)])],544),e.renderSlot(t.$slots,"default")],16)],6))}})});
