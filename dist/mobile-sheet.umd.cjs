(function(e,p){typeof exports=="object"&&typeof module<"u"?module.exports=p(require("vue")):typeof define=="function"&&define.amd?define(["vue"],p):(e=typeof globalThis<"u"?globalThis:e||self,e.MobileSheet=p(e.Vue))})(this,function(e){"use strict";const p=(n,s,o)=>Math.min(Math.max(n,s),o),L=(n,s,o)=>{let l=n;if(n>o){const a=l-o;l-=a*.6}return n<s&&(l-=l*.6),l},M=({progress:n,duration:s})=>{const o=e.ref(n.value),l=e.ref(null);e.watch(n,(d,g)=>a(g,d));const a=(d,g)=>{const f=performance.now(),c=i=>i*(2-i),m=()=>{const i=performance.now()-f,h=p(i/s,0,1);o.value=c(h)*(g-d)+d,h<1&&(l.value=requestAnimationFrame(m))};l.value=requestAnimationFrame(m)};return e.onUnmounted(()=>{l.value&&cancelAnimationFrame(l.value)}),{animatedProgress:o}};function P(n){const s=e.ref(!1);let o=null,l=null,a=null,d=null;const g=9,f=()=>{s.value=!0,o=document.activeElement,a==null||a.focus()},c=()=>{s.value=!1,o==null||o.focus()},m=i=>{if(s.value){var h=i.key==="Tab"||i.keyCode===g;h&&(i.shiftKey?document.activeElement===a&&(d==null||d.focus(),i.preventDefault()):document.activeElement===d&&(a==null||a.focus(),i.preventDefault()))}};return e.watchEffect(()=>{n.value&&(console.log(n.value),l=n.value.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])'),a=l[0],d=l[l.length-1],n.value.addEventListener("keydown",m))}),e.onUnmounted(()=>{var i;return(i=n.value)==null?void 0:i.removeEventListener("keydown",m)}),{trap:f,release:c,isLocked:s}}const S=`<svg width="70" height="3" viewBox="0 0 70 3" xmlns="http://www.w3.org/2000/svg">
<rect width="70" height="3" rx="3" fill="currentColor"/>
</svg>
`,Y=["aria-hidden"],R=["innerHTML"],A={inheritAttrs:!1};return e.defineComponent({...A,__name:"mobile-card",props:{rootClass:{type:String,default:""},maxDistance:{type:Number,default:null},open:{type:Boolean,default:!1},dragEntireCard:{type:Boolean,default:!0},thresHold:{type:Number,default:50},handleHeight:{type:Number,default:50}},emits:["progress","open","close","drag","start-drag","stop-drag"],setup(n,{emit:s}){const o=n,l=typeof document<"u",a=e.ref(null),d=e.ref(null),g=e.ref(null),f=e.ref(!1),c=e.ref(o.maxDistance),m=e.ref(o.handleHeight),i=e.ref(!0),h=e.ref(!1),T=e.ref(0),u=e.ref(0),w=e.ref(!1),{trap:B,release:N}=P(d);e.onMounted(()=>{window.addEventListener("click",t=>O(t),{passive:!0}),window.addEventListener("mouseup",()=>H(),{passive:!0}),window.addEventListener("mousemove",k,{passive:!0})}),e.onUnmounted(()=>{window.removeEventListener("mousemove",()=>{}),window.removeEventListener("mouseup",()=>{})});const q=()=>{f.value||(u.value=c.value,s("open"))},C=()=>{f.value||(u.value=0,s("close"))},z=()=>{w.value?C():q()},O=t=>{a.value&&(a.value.contains(t.target)||C())},y=t=>{if(t.target instanceof HTMLElement&&t.target.closest("[data-ignore-drag]"))return;h.value=!0;const r=t instanceof TouchEvent?t.touches[0].clientY:t.clientY;T.value=r+u.value,s("start-drag")};let x=0;const E=e.ref(!1),k=t=>{if(!h.value)return;const r=t instanceof TouchEvent?t.touches[0].clientY:t.clientY;E.value||(x=r),E.value=!0,Math.abs(x-r)>2&&(f.value=!0),u.value=L(T.value-r,0,c.value),s("drag",u.value)},H=async()=>{await new Promise(t=>setTimeout(t,10)),h.value=!1,f.value=!1,E.value=!1,w.value?u.value<c.value-o.thresHold?u.value=0:u.value=c.value:u.value>=o.thresHold?u.value=c.value:u.value=0,s("stop-drag")},V=e.computed(()=>{const t={position:"fixed",willChange:"transform",left:0,right:0,transition:f.value||i.value?"none":"transform 0.2s ease-out"};return t.top="100%",t.transform=`translateY(${(u.value+m.value)*-1}px)`,t}),b=l?new ResizeObserver(t=>{if(!a.value)return;const{blockSize:r}=t[0].borderBoxSize[0],v=window.innerHeight;g.value&&(m.value=g.value.clientHeight),c.value=p(r,0,v)-m.value,i.value&&o.open&&(u.value=c.value)}):null;e.onMounted(()=>{setTimeout(()=>i.value=!1,1)});const $=e.computed(()=>p(u.value/c.value,0,1)),{animatedProgress:D}=M({progress:$,duration:250});return e.watch(D,()=>{s("progress",D.value)}),e.watch(w,()=>w.value?B():N()),e.watch(u,()=>{f.value||(w.value=u.value>o.thresHold)}),e.watchEffect(()=>{a.value&&(b==null||b.observe(a.value))}),(t,r)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"cardRef",ref:a,style:e.normalizeStyle(e.unref(V)),class:e.normalizeClass([n.rootClass]),"data-modal-sheet":"",role:"dialog","aria-labelledby":"myDialog","aria-hidden":!w.value},[e.createElementVNode("div",e.mergeProps({ref_key:"innerCardRef",ref:d},t.$attrs,{style:{marginTop:"0px !important",touchAction:"none"},onTouchend:r[2]||(r[2]=()=>H()),onTouchmovePassive:k,onMousedown:r[3]||(r[3]=v=>n.dragEntireCard?y(v):null),onTouchstartPassive:r[4]||(r[4]=v=>n.dragEntireCard?y(v):null)}),[e.createElementVNode("button",{ref_key:"handleRef",ref:g,onClick:z,onMousedown:r[0]||(r[0]=v=>n.dragEntireCard?null:y(v)),onTouchstartPassive:r[1]||(r[1]=v=>n.dragEntireCard?null:y(v))},[e.renderSlot(t.$slots,"handle",{},()=>[e.createElementVNode("div",{style:{userSelect:"none",cursor:"move",height:"50px",position:"relative",width:"100%",color:"white",display:"flex",alignItems:"center",justifyContent:"center"},innerHTML:e.unref(S)},null,8,R)])],544),e.renderSlot(t.$slots,"default")],16)],14,Y))}})});
