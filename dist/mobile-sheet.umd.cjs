(function(e,p){typeof exports=="object"&&typeof module<"u"?module.exports=p(require("vue")):typeof define=="function"&&define.amd?define(["vue"],p):(e=typeof globalThis<"u"?globalThis:e||self,e.MobileSheet=p(e.Vue))})(this,function(e){"use strict";const p=(n,r,a)=>Math.min(Math.max(n,r),a),L=(n,r,a)=>{let s=n;if(n>a){const o=s-a;s-=o*.6}return n<r&&(s-=s*.6),s},M=({progress:n,duration:r})=>{const a=e.ref(n.value),s=e.ref(null);e.watch(n,(d,m)=>o(m,d));const o=(d,m)=>{const c=performance.now(),f=i=>i*(2-i),g=()=>{const i=performance.now()-c,h=p(i/r,0,1);a.value=f(h)*(m-d)+d,h<1&&(s.value=requestAnimationFrame(g))};s.value=requestAnimationFrame(g)};return e.onUnmounted(()=>{s.value&&cancelAnimationFrame(s.value)}),{animatedProgress:a}};function S(n){const r=e.ref(!1);let a=null,s=null,o=null,d=null;const m=9,c=()=>{r.value=!0,a=document.activeElement,o==null||o.focus()},f=()=>{r.value=!1,a==null||a.focus()},g=i=>{if(r.value){var h=i.key==="Tab"||i.keyCode===m;h&&(i.shiftKey?document.activeElement===o&&(d==null||d.focus(),i.preventDefault()):document.activeElement===d&&(o==null||o.focus(),i.preventDefault()))}};return e.watchEffect(()=>{n.value&&(console.log(n.value),s=n.value.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])'),o=s[0],d=s[s.length-1],n.value.addEventListener("keydown",g))}),e.onUnmounted(()=>{var i;return(i=n.value)==null?void 0:i.removeEventListener("keydown",g)}),{trap:c,release:f,isLocked:r}}const Y=`<svg width="70" height="3" viewBox="0 0 70 3" xmlns="http://www.w3.org/2000/svg">
<rect width="70" height="3" rx="3" fill="currentColor"/>
</svg>
`,R=["aria-hidden"],A=["innerHTML"],B={inheritAttrs:!1};return e.defineComponent({...B,__name:"mobile-card",props:{rootClass:{type:String,default:""},maxDistance:{type:Number,default:null},open:{type:Boolean,default:!1},dragEntireCard:{type:Boolean,default:!0},thresHold:{type:Number,default:50},handleHeight:{type:Number,default:50}},emits:["progress","open","close","drag","start-drag","stop-drag"],setup(n,{emit:r}){const a=n,s=typeof document<"u",o=e.ref(null),d=e.ref(null),m=e.ref(null),c=e.ref(!1),f=e.ref(a.maxDistance),g=e.ref(a.handleHeight),i=e.ref(!0),h=e.ref(!1),C=e.ref(0),u=e.ref(0),w=e.ref(!1),E=e.ref(!1),{trap:N,release:q}=S(d);e.onMounted(()=>{window.addEventListener("click",t=>V(t),{passive:!0}),window.addEventListener("mouseup",()=>D(),{passive:!0}),window.addEventListener("mousemove",H,{passive:!0})}),e.onUnmounted(()=>{window.removeEventListener("mousemove",()=>{}),window.removeEventListener("mouseup",()=>{})});const z=()=>{c.value||(u.value=f.value,r("open"))},k=()=>{c.value||(u.value=0,r("close"))},O=()=>{w.value?k():z()},V=t=>{o.value&&(o.value.contains(t.target)||k())},y=t=>{if(t.target instanceof HTMLElement&&t.target.closest("[data-ignore-drag]"))return;h.value=!0;const l=t instanceof TouchEvent?t.touches[0].clientY:t.clientY;C.value=l+u.value,r("start-drag")};let x=0;const b=e.ref(!1),H=t=>{if(!h.value)return;const l=t instanceof TouchEvent?t.touches[0].clientY:t.clientY;b.value||(x=l),b.value=!0,Math.abs(x-l)>2&&(c.value=!0),u.value=L(C.value-l,0,f.value),r("drag",u.value)},D=async()=>{await new Promise(t=>setTimeout(t,10)),h.value=!1,c.value=!1,b.value=!1,w.value?u.value<f.value-a.thresHold?u.value=0:u.value=f.value:u.value>=a.thresHold?u.value=f.value:u.value=0,r("stop-drag")},$=e.computed(()=>{const t={position:"fixed",willChange:"transform",left:0,right:0,transition:c.value||i.value?"none":"transform 0.2s ease-out"};return t.top="100%",t.transform=`translateY(${(u.value+g.value)*-1}px)`,t}),T=s?new ResizeObserver(t=>{if(!o.value)return;const{blockSize:l}=t[0].borderBoxSize[0],v=window.innerHeight;m.value&&(g.value=m.value.clientHeight),f.value=p(l,0,v)-g.value,i.value&&a.open&&(u.value=f.value)}):null;e.onMounted(()=>{setTimeout(()=>i.value=!1,1)});const I=e.computed(()=>p(u.value/f.value,0,1)),{animatedProgress:P}=M({progress:I,duration:250});return e.watch(P,()=>{r("progress",P.value)}),e.watch(w,()=>{w.value?N():q()}),e.watch(E,()=>{E.value?document.documentElement.style.setProperty("overflow","hidden"):document.documentElement.style.removeProperty("overflow")}),e.watch(c,()=>E.value=c.value||w.value),e.watch(u,()=>{c.value||(w.value=u.value>a.thresHold)}),e.watchEffect(()=>{o.value&&(T==null||T.observe(o.value))}),(t,l)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"cardRef",ref:o,style:e.normalizeStyle(e.unref($)),class:e.normalizeClass([n.rootClass]),"data-modal-sheet":"",role:"dialog","aria-labelledby":"myDialog","aria-hidden":!w.value},[e.createElementVNode("div",e.mergeProps({ref_key:"innerCardRef",ref:d},t.$attrs,{style:{marginTop:"0px !important",touchAction:"none"},onTouchend:l[2]||(l[2]=()=>D()),onTouchmovePassive:H,onMousedown:l[3]||(l[3]=v=>n.dragEntireCard?y(v):null),onTouchstartPassive:l[4]||(l[4]=v=>n.dragEntireCard?y(v):null)}),[e.createElementVNode("button",{ref_key:"handleRef",ref:m,onClick:O,onMousedown:l[0]||(l[0]=v=>n.dragEntireCard?null:y(v)),onTouchstartPassive:l[1]||(l[1]=v=>n.dragEntireCard?null:y(v))},[e.renderSlot(t.$slots,"handle",{},()=>[e.createElementVNode("div",{style:{userSelect:"none",cursor:"move",height:"50px",position:"relative",width:"100%",color:"white",display:"flex",alignItems:"center",justifyContent:"center"},innerHTML:e.unref(Y)},null,8,A)])],544),e.renderSlot(t.$slots,"default")],16)],14,R))}})});
